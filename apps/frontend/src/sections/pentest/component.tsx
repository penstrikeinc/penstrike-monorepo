'use client';

// @mui
import { alpha, useTheme } from '@mui/material/styles';
import Box from '@mui/material/Box';
import Container from '@mui/material/Container';
// components
import { Button, Typography } from '@mui/material';
import { FaHandPaper, FaPlus } from 'react-icons/fa';
import { CgFileAdd } from 'react-icons/cg';
import { useCallback, useState } from 'react';
import { useSettingsContext } from 'src/components/settings';

import { useMockedUser } from 'src/hooks/use-mocked-user';
import { pentestDefaultValues, TPentest } from 'src/schemas';
import { AddEditPentestDialog } from 'src/components/dialogs/add-edit-pentest';

// ----------------------------------------------------------------------

export function Pentest() {
  const settings = useSettingsContext();
  const { user } = useMockedUser();
  const theme = useTheme();

  const [pentestDialogContext, setPentestDialogContext] = useState<TPentest | null>(null);

  const addPentestDialogOpenHandler = useCallback(async (context: TPentest | null) => {
    setPentestDialogContext(context ?? pentestDefaultValues);
  }, []);

  const addEditPentestCloseHandler = useCallback(() => {
    setPentestDialogContext(null);
  }, []);

  return (
    <Container maxWidth={settings.themeStretch ? false : 'xl'}>
      <Box
        sx={{
          mt: 5,
        }}
      >
        <Typography variant="h4" color="text.secondary">
          Pentest
        </Typography>

        <Box
          sx={{
            pt: 5,
          }}
        >
          <Typography variant="h4" mb={3}>
            <FaHandPaper /> Welcome,{' '}
            <span style={{ color: theme.palette.primary.main }}>{user?.displayName}</span>
          </Typography>
          <Typography variant="h6">Start first pentest. </Typography>
          <Typography variant="body2" color="text.secondary">
            Start your first pentest journey with us. We are here to secure your business.
          </Typography>
        </Box>
      </Box>
      <Button
        sx={{
          p: 0,
          mt: 5,
          width: 1,
          height: 230,
          borderRadius: 2,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          bgcolor: alpha(theme.palette.grey[500], 0.04),
          border: `dashed 1px ${theme.palette.primary.main}`,
        }}
        onClick={() => addPentestDialogOpenHandler(null)}
      >
        <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
          <Box
            sx={{
              mb: 2,
              width: 100,
              height: 100,
              borderRadius: 50,
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              bgcolor: alpha(theme.palette.primary.main, 0.04),
              border: `dashed 1px ${theme.palette.primary.main}`,
            }}
          >
            <CgFileAdd size={50} color={theme.palette.primary.main} />
          </Box>
          <Typography variant="h6" color={theme.palette.primary.main}>
            <FaPlus size={14} style={{ marginRight: 3 }} />
            Create New Pentest
          </Typography>
        </Box>
      </Button>
      <AddEditPentestDialog
        open={Boolean(pentestDialogContext)}
        context={pentestDialogContext}
        onClose={addEditPentestCloseHandler}
      />
    </Container>
  );
}
